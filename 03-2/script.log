Script started on 2023-05-21 11:16:11+03:00 [TERM="tmux-256color" TTY="/dev/pts/2" COLUMNS="190" LINES="50"]
[?2004h[01;32mzoid@npc[00m:[01;34m~/projects/otus/2023-04-linux/03-2[00m$ vagrant up
[?2004l[0mBringing machine 'lvm' up with 'virtualbox' provider...[0m
[1m==> lvm: Importing base box 'centos/7'...[0m
[0m[K[0m[0mProgress: 20%[0m[0m[K[0m[0mProgress: 40%[0m[0m[K[0m[0mProgress: 70%[0m[0m[K[0m[0mProgress: 90%[0m[0m[K[0m[1m==> lvm: Matching MAC address for NAT networking...[0m
[1m==> lvm: Checking if box 'centos/7' version '1804.02' is up to date...[0m
[1;33m==> lvm: There was a problem while downloading the metadata for your box
==> lvm: to check for updates. This is not an error, since it is usually due
==> lvm: to temporary network problems. This is just a warning. The problem
==> lvm: encountered was:
==> lvm: 
==> lvm: The requested URL returned error: 404
==> lvm: 
==> lvm: If you want to check for box updates, verify your network connection
==> lvm: is valid and try again.[0m
[1m==> lvm: Setting the name of the VM: 03-2_lvm_1684656987645_79476[0m
[1m==> lvm: Clearing any previously set network interfaces...[0m
[1m==> lvm: Preparing network interfaces based on configuration...[0m
[0m    lvm: Adapter 1: nat[0m
[1m==> lvm: Forwarding ports...[0m
[0m    lvm: 22 (guest) => 2222 (host) (adapter 1)[0m
[1m==> lvm: Running 'pre-boot' VM customizations...[0m
[1m==> lvm: Booting VM...[0m
[1m==> lvm: Waiting for machine to boot. This may take a few minutes...[0m
[0m    lvm: SSH address: 127.0.0.1:2222[0m
[0m    lvm: SSH username: vagrant[0m
[0m    lvm: SSH auth method: private key[0m
[0m    lvm: 
    lvm: Vagrant insecure key detected. Vagrant will automatically replace
    lvm: this with a newly generated keypair for better security.[0m
[0m    lvm: 
    lvm: Inserting generated public key within guest...[0m
[0m    lvm: Removing insecure key from the guest if it's present...[0m
[0m    lvm: Key inserted! Disconnecting and reconnecting using new SSH key...[0m
[1m==> lvm: Machine booted and ready![0m
[1m==> lvm: Checking for guest additions in VM...[0m
[0m    lvm: No guest additions were detected on the base box for this VM! Guest
    lvm: additions are required for forwarded ports, shared folders, host only
    lvm: networking, and more. If SSH fails on this machine, please install
    lvm: the guest additions and repackage the box to continue.
    lvm: 
    lvm: This is not an error message; everything may continue to work properly,
    lvm: in which case you may ignore this message.[0m
[1m==> lvm: Setting hostname...[0m
[1m==> lvm: Rsyncing folder: /home/zoid/projects/otus/2023-04-linux/03-2/ => /vagrant[0m
[1m==> lvm: Running provisioner: shell...[0m
[0m    lvm: Running: inline script[0m
[0;32m    lvm: Loaded plugins: fastestmirror[0m
[0;32m    lvm: Determining fastest mirrors[0m
[0;32m    lvm:  * base: mirrors.powernet.com.ru[0m
[0;32m    lvm:  * extras: mirrors.powernet.com.ru[0m
[0;32m    lvm:  * updates: mirrors.powernet.com.ru[0m
[0;32m    lvm: Resolving Dependencies[0m
[0;32m    lvm: --> Running transaction check[0m
[0;32m    lvm: ---> Package gdisk.x86_64 0:0.8.10-3.el7 will be installed[0m
[0;32m    lvm: ---> Package hdparm.x86_64 0:9.43-5.el7 will be installed[0m
[0;32m    lvm: ---> Package mdadm.x86_64 0:4.1-9.el7_9 will be installed[0m
[0;32m    lvm: --> Processing Dependency: libreport-filesystem for package: mdadm-4.1-9.el7_9.x86_64[0m
[0;32m    lvm: ---> Package smartmontools.x86_64 1:7.0-2.el7 will be installed[0m
[0;32m    lvm: --> Processing Dependency: mailx for package: 1:smartmontools-7.0-2.el7.x86_64[0m
[0;32m    lvm: ---> Package vim-enhanced.x86_64 2:7.4.629-8.el7_9 will be installed[0m
[0;32m    lvm: --> Processing Dependency: vim-common = 2:7.4.629-8.el7_9 for package: 2:vim-enhanced-7.4.629-8.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(:MODULE_COMPAT_5.16.3) for package: 2:vim-enhanced-7.4.629-8.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: libperl.so()(64bit) for package: 2:vim-enhanced-7.4.629-8.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: libgpm.so.2()(64bit) for package: 2:vim-enhanced-7.4.629-8.el7_9.x86_64[0m
[0;32m    lvm: ---> Package xfsdump.x86_64 0:3.1.7-3.el7_9 will be installed[0m
[0;32m    lvm: --> Processing Dependency: attr >= 2.0.0 for package: xfsdump-3.1.7-3.el7_9.x86_64[0m
[0;32m    lvm: --> Running transaction check[0m
[0;32m    lvm: ---> Package attr.x86_64 0:2.4.46-13.el7 will be installed[0m
[0;32m    lvm: ---> Package gpm-libs.x86_64 0:1.20.7-6.el7 will be installed[0m
[0;32m    lvm: ---> Package libreport-filesystem.x86_64 0:2.1.11-53.el7.centos will be installed[0m
[0;32m    lvm: ---> Package mailx.x86_64 0:12.5-19.el7 will be installed[0m
[0;32m    lvm: ---> Package perl.x86_64 4:5.16.3-299.el7_9 will be installed[0m
[0;32m    lvm: --> Processing Dependency: perl(Socket) >= 1.3 for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(Scalar::Util) >= 1.10 for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl-macros for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(threads::shared) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(threads) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(constant) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(Time::Local) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(Time::HiRes) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(Storable) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(Socket) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(Scalar::Util) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(Pod::Simple::XHTML) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(Pod::Simple::Search) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(Getopt::Long) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(Filter::Util::Call) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(File::Temp) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(File::Spec::Unix) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(File::Spec::Functions) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(File::Spec) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(File::Path) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(Exporter) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(Cwd) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: --> Processing Dependency: perl(Carp) for package: 4:perl-5.16.3-299.el7_9.x86_64[0m
[0;32m    lvm: ---> Package perl-libs.x86_64 4:5.16.3-299.el7_9 will be installed[0m
[0;32m    lvm: ---> Package vim-common.x86_64 2:7.4.629-8.el7_9 will be installed[0m
[0;32m    lvm: --> Processing Dependency: vim-filesystem for package: 2:vim-common-7.4.629-8.el7_9.x86_64[0m
[0;32m    lvm: --> Running transaction check[0m
[0;32m    lvm: ---> Package perl-Carp.noarch 0:1.26-244.el7 will be installed[0m
[0;32m    lvm: ---> Package perl-Exporter.noarch 0:5.68-3.el7 will be installed[0m
[0;32m    lvm: ---> Package perl-File-Path.noarch 0:2.09-2.el7 will be installed[0m
[0;32m    lvm: ---> Package perl-File-Temp.noarch 0:0.23.01-3.el7 will be installed[0m
[0;32m    lvm: ---> Package perl-Filter.x86_64 0:1.49-3.el7 will be installed[0m
[0;32m    lvm: ---> Package perl-Getopt-Long.noarch 0:2.40-3.el7 will be installed[0m
[0;32m    lvm: --> Processing Dependency: perl(Pod::Usage) >= 1.14 for package: perl-Getopt-Long-2.40-3.el7.noarch[0m
[0;32m    lvm: --> Processing Dependency: perl(Text::ParseWords) for package: perl-Getopt-Long-2.40-3.el7.noarch[0m
[0;32m    lvm: ---> Package perl-PathTools.x86_64 0:3.40-5.el7 will be installed[0m
[0;32m    lvm: ---> Package perl-Pod-Simple.noarch 1:3.28-4.el7 will be installed[0m
[0;32m    lvm: --> Processing Dependency: perl(Pod::Escapes) >= 1.04 for package: 1:perl-Pod-Simple-3.28-4.el7.noarch[0m
[0;32m    lvm: --> Processing Dependency: perl(Encode) for package: 1:perl-Pod-Simple-3.28-4.el7.noarch[0m
[0;32m    lvm: ---> Package perl-Scalar-List-Utils.x86_64 0:1.27-248.el7 will be installed[0m
[0;32m    lvm: ---> Package perl-Socket.x86_64 0:2.010-5.el7 will be installed[0m
[0;32m    lvm: ---> Package perl-Storable.x86_64 0:2.45-3.el7 will be installed[0m
[0;32m    lvm: ---> Package perl-Time-HiRes.x86_64 4:1.9725-3.el7 will be installed[0m
[0;32m    lvm: ---> Package perl-Time-Local.noarch 0:1.2300-2.el7 will be installed[0m
[0;32m    lvm: ---> Package perl-constant.noarch 0:1.27-2.el7 will be installed[0m
[0;32m    lvm: ---> Package perl-macros.x86_64 4:5.16.3-299.el7_9 will be installed[0m
[0;32m    lvm: ---> Package perl-threads.x86_64 0:1.87-4.el7 will be installed[0m
[0;32m    lvm: ---> Package perl-threads-shared.x86_64 0:1.43-6.el7 will be installed[0m
[0;32m    lvm: ---> Package vim-filesystem.x86_64 2:7.4.629-8.el7_9 will be installed[0m
[0;32m    lvm: --> Running transaction check[0m
[0;32m    lvm: ---> Package perl-Encode.x86_64 0:2.51-7.el7 will be installed[0m
[0;32m    lvm: ---> Package perl-Pod-Escapes.noarch 1:1.04-299.el7_9 will be installed[0m
[0;32m    lvm: ---> Package perl-Pod-Usage.noarch 0:1.63-3.el7 will be installed[0m
[0;32m    lvm: --> Processing Dependency: perl(Pod::Text) >= 3.15 for package: perl-Pod-Usage-1.63-3.el7.noarch[0m
[0;32m    lvm: --> Processing Dependency: perl-Pod-Perldoc for package: perl-Pod-Usage-1.63-3.el7.noarch[0m
[0;32m    lvm: ---> Package perl-Text-ParseWords.noarch 0:3.29-4.el7 will be installed[0m
[0;32m    lvm: --> Running transaction check[0m
[0;32m    lvm: ---> Package perl-Pod-Perldoc.noarch 0:3.20-4.el7 will be installed[0m
[0;32m    lvm: --> Processing Dependency: perl(parent) for package: perl-Pod-Perldoc-3.20-4.el7.noarch[0m
[0;32m    lvm: --> Processing Dependency: perl(HTTP::Tiny) for package: perl-Pod-Perldoc-3.20-4.el7.noarch[0m
[0;32m    lvm: ---> Package perl-podlators.noarch 0:2.5.1-3.el7 will be installed[0m
[0;32m    lvm: --> Running transaction check[0m
[0;32m    lvm: ---> Package perl-HTTP-Tiny.noarch 0:0.033-3.el7 will be installed[0m
[0;32m    lvm: ---> Package perl-parent.noarch 1:0.225-244.el7 will be installed[0m
[0;32m    lvm: --> Finished Dependency Resolution[0m
[0;32m    lvm: [0m
[0;32m    lvm: Dependencies Resolved[0m
[0;32m    lvm: [0m
[0;32m    lvm: ================================================================================[0m
[0;32m    lvm:  Package                   Arch      Version                   Repository  Size[0m
[0;32m    lvm: ================================================================================[0m
[0;32m    lvm: Installing:[0m
[0;32m    lvm:  gdisk                     x86_64    0.8.10-3.el7              base       190 k[0m
[0;32m    lvm:  hdparm                    x86_64    9.43-5.el7                base        83 k[0m
[0;32m    lvm:  mdadm                     x86_64    4.1-9.el7_9               updates    439 k[0m
[0;32m    lvm:  smartmontools             x86_64    1:7.0-2.el7               base       546 k[0m
[0;32m    lvm:  vim-enhanced              x86_64    2:7.4.629-8.el7_9         updates    1.1 M[0m
[0;32m    lvm:  xfsdump                   x86_64    3.1.7-3.el7_9             updates    309 k[0m
[0;32m    lvm: Installing for dependencies:[0m
[0;32m    lvm:  attr                      x86_64    2.4.46-13.el7             base        66 k[0m
[0;32m    lvm:  gpm-libs                  x86_64    1.20.7-6.el7              base        32 k[0m
[0;32m    lvm:  libreport-filesystem      x86_64    2.1.11-53.el7.centos      base        41 k[0m
[0;32m    lvm:  mailx                     x86_64    12.5-19.el7               base       245 k[0m
[0;32m    lvm:  perl                      x86_64    4:5.16.3-299.el7_9        updates    8.0 M[0m
[0;32m    lvm:  perl-Carp                 noarch    1.26-244.el7              base        19 k[0m
[0;32m    lvm:  perl-Encode               x86_64    2.51-7.el7                base       1.5 M[0m
[0;32m    lvm:  perl-Exporter             noarch    5.68-3.el7                base        28 k[0m
[0;32m    lvm:  perl-File-Path            noarch    2.09-2.el7                base        26 k[0m
[0;32m    lvm:  perl-File-Temp            noarch    0.23.01-3.el7             base        56 k[0m
[0;32m    lvm:  perl-Filter               x86_64    1.49-3.el7                base        76 k[0m
[0;32m    lvm:  perl-Getopt-Long          noarch    2.40-3.el7                base        56 k[0m
[0;32m    lvm:  perl-HTTP-Tiny            noarch    0.033-3.el7               base        38 k[0m
[0;32m    lvm:  perl-PathTools            x86_64    3.40-5.el7                base        82 k[0m
[0;32m    lvm:  perl-Pod-Escapes          noarch    1:1.04-299.el7_9          updates     52 k[0m
[0;32m    lvm:  perl-Pod-Perldoc          noarch    3.20-4.el7                base        87 k[0m
[0;32m    lvm:  perl-Pod-Simple           noarch    1:3.28-4.el7              base       216 k[0m
[0;32m    lvm:  perl-Pod-Usage            noarch    1.63-3.el7                base        27 k[0m
[0;32m    lvm:  perl-Scalar-List-Utils    x86_64    1.27-248.el7              base        36 k[0m
[0;32m    lvm:  perl-Socket               x86_64    2.010-5.el7               base        49 k[0m
[0;32m    lvm:  perl-Storable             x86_64    2.45-3.el7                base        77 k[0m
[0;32m    lvm:  perl-Text-ParseWords      noarch    3.29-4.el7                base        14 k[0m
[0;32m    lvm:  perl-Time-HiRes           x86_64    4:1.9725-3.el7            base        45 k[0m
[0;32m    lvm:  perl-Time-Local           noarch    1.2300-2.el7              base        24 k[0m
[0;32m    lvm:  perl-constant             noarch    1.27-2.el7                base        19 k[0m
[0;32m    lvm:  perl-libs                 x86_64    4:5.16.3-299.el7_9        updates    690 k[0m
[0;32m    lvm:  perl-macros               x86_64    4:5.16.3-299.el7_9        updates     44 k[0m
[0;32m    lvm:  perl-parent               noarch    1:0.225-244.el7           base        12 k[0m
[0;32m    lvm:  perl-podlators            noarch    2.5.1-3.el7               base       112 k[0m
[0;32m    lvm:  perl-threads              x86_64    1.87-4.el7                base        49 k[0m
[0;32m    lvm:  perl-threads-shared       x86_64    1.43-6.el7                base        39 k[0m
[0;32m    lvm:  vim-common                x86_64    2:7.4.629-8.el7_9         updates    5.9 M[0m
[0;32m    lvm:  vim-filesystem            x86_64    2:7.4.629-8.el7_9         updates     11 k[0m
[0;32m    lvm: [0m
[0;32m    lvm: Transaction Summary[0m
[0;32m    lvm: ================================================================================[0m
[0;32m    lvm: Install  6 Packages (+33 Dependent packages)[0m
[0;32m    lvm: [0m
[0;32m    lvm: Total download size: 20 M[0m
[0;32m    lvm: Installed size: 65 M[0m
[0;32m    lvm: Downloading packages:[0m
[0;32m    lvm: Public key for gpm-libs-1.20.7-6.el7.x86_64.rpm is not installed[0m
[0;31m    lvm: warning: /var/cache/yum/x86_64/7/base/packages/gpm-libs-1.20.7-6.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY[0m
[0;32m    lvm: Public key for perl-Pod-Escapes-1.04-299.el7_9.noarch.rpm is not installed[0m
[0;32m    lvm: --------------------------------------------------------------------------------[0m
[0;32m    lvm: Total                                              5.0 MB/s |  20 MB  00:04[0m
[0;32m    lvm: Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7[0m
[0;31m    lvm: Importing GPG key 0xF4A80EB5:[0m
[0;31m    lvm:  Userid     : "CentOS-7 Key (CentOS 7 Official Signing Key) <security@centos.org>"[0m
[0;31m    lvm:  Fingerprint: 6341 ab27 53d7 8a78 a7c2 7bb1 24c6 a8a7 f4a8 0eb5[0m
[0;31m    lvm:  Package    : centos-release-7-5.1804.el7.centos.x86_64 (@anaconda)[0m
[0;31m    lvm:  From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7[0m
[0;32m    lvm: Running transaction check[0m
[0;32m    lvm: Running transaction test[0m
[0;32m    lvm: Transaction test succeeded[0m
[0;32m    lvm: Running transaction[0m
[0;32m    lvm:   Installing : 1:perl-parent-0.225-244.el7.noarch                          1/39[0m
[0;32m    lvm:   Installing : perl-HTTP-Tiny-0.033-3.el7.noarch                           2/39[0m
[0;32m    lvm:   Installing : perl-podlators-2.5.1-3.el7.noarch                           3/39[0m
[0;32m    lvm:   Installing : perl-Pod-Perldoc-3.20-4.el7.noarch                          4/39[0m
[0;32m    lvm:   Installing : 1:perl-Pod-Escapes-1.04-299.el7_9.noarch                    5/39[0m
[0;32m    lvm:   Installing : perl-Encode-2.51-7.el7.x86_64                               6/39[0m
[0;32m    lvm:   Installing : perl-Text-ParseWords-3.29-4.el7.noarch                      7/39[0m
[0;32m    lvm:   Installing : perl-Pod-Usage-1.63-3.el7.noarch                            8/39[0m
[0;32m    lvm:   Installing : 4:perl-macros-5.16.3-299.el7_9.x86_64                       9/39[0m
[0;32m    lvm:   Installing : perl-Storable-2.45-3.el7.x86_64                            10/39[0m
[0;32m    lvm:   Installing : perl-Exporter-5.68-3.el7.noarch                            11/39[0m
[0;32m    lvm:   Installing : perl-constant-1.27-2.el7.noarch                            12/39[0m
[0;32m    lvm:   Installing : perl-Socket-2.010-5.el7.x86_64                             13/39[0m
[0;32m    lvm:   Installing : perl-Time-Local-1.2300-2.el7.noarch                        14/39[0m
[0;32m    lvm:   Installing : perl-PathTools-3.40-5.el7.x86_64                           15/39[0m
[0;32m    lvm:   Installing : perl-Scalar-List-Utils-1.27-248.el7.x86_64                 16/39[0m
[0;32m    lvm:   Installing : 1:perl-Pod-Simple-3.28-4.el7.noarch                        17/39[0m
[0;32m    lvm:   Installing : perl-File-Temp-0.23.01-3.el7.noarch                        18/39[0m
[0;32m    lvm:   Installing : perl-File-Path-2.09-2.el7.noarch                           19/39[0m
[0;32m    lvm:   Installing : perl-threads-shared-1.43-6.el7.x86_64                      20/39[0m
[0;32m    lvm:   Installing : perl-threads-1.87-4.el7.x86_64                             21/39[0m
[0;32m    lvm:   Installing : 4:perl-Time-HiRes-1.9725-3.el7.x86_64                      22/39[0m
[0;32m    lvm:   Installing : perl-Filter-1.49-3.el7.x86_64                              23/39[0m
[0;32m    lvm:   Installing : perl-Carp-1.26-244.el7.noarch                              24/39[0m
[0;32m    lvm:   Installing : 4:perl-libs-5.16.3-299.el7_9.x86_64                        25/39[0m
[0;32m    lvm:   Installing : perl-Getopt-Long-2.40-3.el7.noarch                         26/39[0m
[0;32m    lvm:   Installing : 4:perl-5.16.3-299.el7_9.x86_64                             27/39[0m
[0;32m    lvm:   Installing : mailx-12.5-19.el7.x86_64                                   28/39[0m
[0;32m    lvm:   Installing : gpm-libs-1.20.7-6.el7.x86_64                               29/39[0m
[0;32m    lvm:   Installing : attr-2.4.46-13.el7.x86_64                                  30/39[0m
[0;32m    lvm:   Installing : libreport-filesystem-2.1.11-53.el7.centos.x86_64           31/39[0m
[0;32m    lvm:   Installing : 2:vim-filesystem-7.4.629-8.el7_9.x86_64                    32/39[0m
[0;32m    lvm:   Installing : 2:vim-common-7.4.629-8.el7_9.x86_64                        33/39[0m
[0;32m    lvm:   Installing : 2:vim-enhanced-7.4.629-8.el7_9.x86_64                      34/39[0m
[0;32m    lvm:   Installing : mdadm-4.1-9.el7_9.x86_64                                   35/39[0m
[0;32m    lvm:   Installing : xfsdump-3.1.7-3.el7_9.x86_64                               36/39[0m
[0;32m    lvm:   Installing : 1:smartmontools-7.0-2.el7.x86_64                           37/39[0m
[0;32m    lvm:   Installing : gdisk-0.8.10-3.el7.x86_64                                  38/39[0m
[0;32m    lvm:   Installing : hdparm-9.43-5.el7.x86_64                                   39/39[0m
[0;32m    lvm:   Verifying  : perl-HTTP-Tiny-0.033-3.el7.noarch                           1/39[0m
[0;32m    lvm:   Verifying  : perl-threads-shared-1.43-6.el7.x86_64                       2/39[0m
[0;32m    lvm:   Verifying  : perl-Storable-2.45-3.el7.x86_64                             3/39[0m
[0;32m    lvm:   Verifying  : perl-Exporter-5.68-3.el7.noarch                             4/39[0m
[0;32m    lvm:   Verifying  : perl-constant-1.27-2.el7.noarch                             5/39[0m
[0;32m    lvm:   Verifying  : 2:vim-enhanced-7.4.629-8.el7_9.x86_64                       6/39[0m
[0;32m    lvm:   Verifying  : xfsdump-3.1.7-3.el7_9.x86_64                                7/39[0m
[0;32m    lvm:   Verifying  : 4:perl-macros-5.16.3-299.el7_9.x86_64                       8/39[0m
[0;32m    lvm:   Verifying  : perl-PathTools-3.40-5.el7.x86_64                            9/39[0m
[0;32m    lvm:   Verifying  : 1:perl-parent-0.225-244.el7.noarch                         10/39[0m
[0;32m    lvm:   Verifying  : perl-Socket-2.010-5.el7.x86_64                             11/39[0m
[0;32m    lvm:   Verifying  : perl-Pod-Usage-1.63-3.el7.noarch                           12/39[0m
[0;32m    lvm:   Verifying  : 2:vim-filesystem-7.4.629-8.el7_9.x86_64                    13/39[0m
[0;32m    lvm:   Verifying  : perl-File-Temp-0.23.01-3.el7.noarch                        14/39[0m
[0;32m    lvm:   Verifying  : 1:perl-Pod-Simple-3.28-4.el7.noarch                        15/39[0m
[0;32m    lvm:   Verifying  : perl-Time-Local-1.2300-2.el7.noarch                        16/39[0m
[0;32m    lvm:   Verifying  : 1:perl-Pod-Escapes-1.04-299.el7_9.noarch                   17/39[0m
[0;32m    lvm:   Verifying  : libreport-filesystem-2.1.11-53.el7.centos.x86_64           18/39[0m
[0;32m    lvm:   Verifying  : 1:smartmontools-7.0-2.el7.x86_64                           19/39[0m
[0;32m    lvm:   Verifying  : 2:vim-common-7.4.629-8.el7_9.x86_64                        20/39[0m
[0;32m    lvm:   Verifying  : perl-Scalar-List-Utils-1.27-248.el7.x86_64                 21/39[0m
[0;32m    lvm:   Verifying  : attr-2.4.46-13.el7.x86_64                                  22/39[0m
[0;32m    lvm:   Verifying  : hdparm-9.43-5.el7.x86_64                                   23/39[0m
[0;32m    lvm:   Verifying  : perl-Encode-2.51-7.el7.x86_64                              24/39[0m
[0;32m    lvm:   Verifying  : perl-Pod-Perldoc-3.20-4.el7.noarch                         25/39[0m
[0;32m    lvm:   Verifying  : perl-podlators-2.5.1-3.el7.noarch                          26/39[0m
[0;32m    lvm:   Verifying  : 4:perl-5.16.3-299.el7_9.x86_64                             27/39[0m
[0;32m    lvm:   Verifying  : perl-File-Path-2.09-2.el7.noarch                           28/39[0m
[0;32m    lvm:   Verifying  : perl-threads-1.87-4.el7.x86_64                             29/39[0m
[0;32m    lvm:   Verifying  : 4:perl-Time-HiRes-1.9725-3.el7.x86_64                      30/39[0m
[0;32m    lvm:   Verifying  : gpm-libs-1.20.7-6.el7.x86_64                               31/39[0m
[0;32m    lvm:   Verifying  : perl-Filter-1.49-3.el7.x86_64                              32/39[0m
[0;32m    lvm:   Verifying  : perl-Getopt-Long-2.40-3.el7.noarch                         33/39[0m
[0;32m    lvm:   Verifying  : perl-Text-ParseWords-3.29-4.el7.noarch                     34/39[0m
[0;32m    lvm:   Verifying  : gdisk-0.8.10-3.el7.x86_64                                  35/39[0m
[0;32m    lvm:   Verifying  : perl-Carp-1.26-244.el7.noarch                              36/39[0m
[0;32m    lvm:   Verifying  : mailx-12.5-19.el7.x86_64                                   37/39[0m
[0;32m    lvm:   Verifying  : 4:perl-libs-5.16.3-299.el7_9.x86_64                        38/39[0m
[0;32m    lvm:   Verifying  : mdadm-4.1-9.el7_9.x86_64                                   39/39[0m
[0;32m    lvm: [0m
[0;32m    lvm: Installed:[0m
[0;32m    lvm:   gdisk.x86_64 0:0.8.10-3.el7               hdparm.x86_64 0:9.43-5.el7[0m
[0;32m    lvm:   mdadm.x86_64 0:4.1-9.el7_9                smartmontools.x86_64 1:7.0-2.el7[0m
[0;32m    lvm:   vim-enhanced.x86_64 2:7.4.629-8.el7_9     xfsdump.x86_64 0:3.1.7-3.el7_9[0m
[0;32m    lvm: [0m
[0;32m    lvm: Dependency Installed:[0m
[0;32m    lvm:   attr.x86_64 0:2.4.46-13.el7[0m
[0;32m    lvm:   gpm-libs.x86_64 0:1.20.7-6.el7[0m
[0;32m    lvm:   libreport-filesystem.x86_64 0:2.1.11-53.el7.centos[0m
[0;32m    lvm:   mailx.x86_64 0:12.5-19.el7[0m
[0;32m    lvm:   perl.x86_64 4:5.16.3-299.el7_9[0m
[0;32m    lvm:   perl-Carp.noarch 0:1.26-244.el7[0m
[0;32m    lvm:   perl-Encode.x86_64 0:2.51-7.el7[0m
[0;32m    lvm:   perl-Exporter.noarch 0:5.68-3.el7[0m
[0;32m    lvm:   perl-File-Path.noarch 0:2.09-2.el7[0m
[0;32m    lvm:   perl-File-Temp.noarch 0:0.23.01-3.el7[0m
[0;32m    lvm:   perl-Filter.x86_64 0:1.49-3.el7[0m
[0;32m    lvm:   perl-Getopt-Long.noarch 0:2.40-3.el7[0m
[0;32m    lvm:   perl-HTTP-Tiny.noarch 0:0.033-3.el7[0m
[0;32m    lvm:   perl-PathTools.x86_64 0:3.40-5.el7[0m
[0;32m    lvm:   perl-Pod-Escapes.noarch 1:1.04-299.el7_9[0m
[0;32m    lvm:   perl-Pod-Perldoc.noarch 0:3.20-4.el7[0m
[0;32m    lvm:   perl-Pod-Simple.noarch 1:3.28-4.el7[0m
[0;32m    lvm:   perl-Pod-Usage.noarch 0:1.63-3.el7[0m
[0;32m    lvm:   perl-Scalar-List-Utils.x86_64 0:1.27-248.el7[0m
[0;32m    lvm:   perl-Socket.x86_64 0:2.010-5.el7[0m
[0;32m    lvm:   perl-Storable.x86_64 0:2.45-3.el7[0m
[0;32m    lvm:   perl-Text-ParseWords.noarch 0:3.29-4.el7[0m
[0;32m    lvm:   perl-Time-HiRes.x86_64 4:1.9725-3.el7[0m
[0;32m    lvm:   perl-Time-Local.noarch 0:1.2300-2.el7[0m
[0;32m    lvm:   perl-constant.noarch 0:1.27-2.el7[0m
[0;32m    lvm:   perl-libs.x86_64 4:5.16.3-299.el7_9[0m
[0;32m    lvm:   perl-macros.x86_64 4:5.16.3-299.el7_9[0m
[0;32m    lvm:   perl-parent.noarch 1:0.225-244.el7[0m
[0;32m    lvm:   perl-podlators.noarch 0:2.5.1-3.el7[0m
[0;32m    lvm:   perl-threads.x86_64 0:1.87-4.el7[0m
[0;32m    lvm:   perl-threads-shared.x86_64 0:1.43-6.el7[0m
[0;32m    lvm:   vim-common.x86_64 2:7.4.629-8.el7_9[0m
[0;32m    lvm:   vim-filesystem.x86_64 2:7.4.629-8.el7_9[0m
[0;32m    lvm: [0m
[0;32m    lvm: Complete![0m
[?2004h[01;32mzoid@npc[00m:[01;34m~/projects/otus/2023-04-linux/03-2[00m$ 
[?2004l[?2004h[01;32mzoid@npc[00m:[01;34m~/projects/otus/2023-04-linux/03-2[00m$ 
[?2004l[?2004h[01;32mzoid@npc[00m:[01;34m~/projects/otus/2023-04-linux/03-2[00m$ 
[?2004l[?2004h[01;32mzoid@npc[00m:[01;34m~/projects/otus/2023-04-linux/03-2[00m$ 
[?2004l[?2004h[01;32mzoid@npc[00m:[01;34m~/projects/otus/2023-04-linux/03-2[00m$ vagrant ssh
[?2004l[vagrant@lvm ~]$ sudo -i
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# lk sblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# # Уменьшаем том под / до 8G
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# # --- подготавливаем временный том для корневого раздела
[root@lvm ~]# pvcreate /dev/sdb
  Physical volume "/dev/sdb" successfully created.
[root@lvm ~]# vgcreate vg_root /dev/sdb
  Volume group "vg_root" successfully created
[root@lvm ~]# lvcreate -n lv_root -l +100%FREE /dev/vg_root
  Logical volume "lv_root" created.
[root@lvm ~]# # --- создаем файловую систему и монтируем его, чтобы перенести туда данные
[root@lvm ~]# mkfs.xfs /dev/vg_root/lv_root
meta-data=/dev/vg_root/lv_root   isize=512    agcount=4, agsize=655104 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=2620416, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[root@lvm ~]# mount /dev/vg_root/lv_root /mnt
[root@lvm ~]# ls /mnt
[root@lvm ~]# # --- копируем все данные из корневого раздела в /mnt
[root@lvm ~]# xfsdump -J - /dev/VolGroup00/LogVol00 | xfsrestore -J - /mnt
xfsdump: using file dump (drive_simple) strategy
xfsdump: version 3.1.7 (dump format 3.0)
xfsrestore: using file dump (drive_simple) strategy
xfsrestore: version 3.1.7 (dump format 3.0)
xfsdump: level 0 dump of lvm:/
xfsdump: dump date: Sun May 21 08:18:49 2023
xfsdump: session id: 8e45f4a4-4d7d-4675-a721-e37390fc93d7
xfsdump: session label: ""
xfsrestore: searching media for dump
xfsdump: ino map phase 1: constructing initial dump list
xfsdump: ino map phase 2: skipping (no pruning necessary)
xfsdump: ino map phase 3: skipping (only one dump stream)
xfsdump: ino map construction complete
xfsdump: estimated dump size: 936077056 bytes
xfsdump: creating dump session media file 0 (media 0, file 0)
xfsdump: dumping ino map
xfsdump: dumping directories
xfsrestore: examining media file 0
xfsrestore: dump description: 
xfsrestore: hostname: lvm
xfsrestore: mount point: /
xfsrestore: volume: /dev/mapper/VolGroup00-LogVol00
xfsrestore: session time: Sun May 21 08:18:49 2023
xfsrestore: level: 0
xfsrestore: session label: ""
xfsrestore: media label: ""
xfsrestore: file system id: b60e9498-0baa-4d9f-90aa-069048217fee
xfsrestore: session id: 8e45f4a4-4d7d-4675-a721-e37390fc93d7
xfsrestore: media id: f8eb3cce-0823-4b37-ac5d-45a12fe3ee80
xfsrestore: searching media for directory dump
xfsrestore: reading directories
xfsdump: dumping non-directory files
xfsrestore: 3159 directories and 28279 entries processed
xfsrestore: directory post-processing
xfsrestore: restoring non-directory files
xfsdump: ending media file
xfsdump: media file size 905891832 bytes
xfsdump: dump size (non-dir files) : 889861040 bytes
xfsdump: dump complete: 10 seconds elapsed
xfsdump: Dump Status: SUCCESS
xfsrestore: restore complete: 10 seconds elapsed
xfsrestore: Restore Status: SUCCESS
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# #    "Сымитируем текущий root -> сделаем в него chroot и обновим grub"
[root@lvm ~]# for i in /proc/ /sys/ /dev/ /run/ /boot/; do mount --bind $i /mnt/$i; done
[root@lvm ~]# chroot /mnt/
[root@lvm /]# grub2-mkconfig -o /boot/grub2/grub.cfg
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-3.10.0-862.2.3.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-862.2.3.el7.x86_64.img
done
[root@lvm /]# cd /boot ; for i in `ls initramfs-*img`; do dracut -v $i `echo $i|sed "s/initramfs-//g;  s/.img//g"` --force; done
Executing: /sbin/dracut -v initramfs-3.10.0-862.2.3.el7.x86_64.img 3.10.0-862.2.3.el7.x86_64 --force
dracut module 'busybox' will not be installed, because command 'busybox' could not be found!
dracut module 'crypt' will not be installed, because command 'cryptsetup' could not be found!
dracut module 'dmraid' will not be installed, because command 'dmraid' could not be found!
dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!
dracut module 'multipath' will not be installed, because command 'multipath' could not be found!
dracut module 'busybox' will not be installed, because command 'busybox' could not be found!
dracut module 'crypt' will not be installed, because command 'cryptsetup' could not be found!
dracut module 'dmraid' will not be installed, because command 'dmraid' could not be found!
dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!
dracut module 'multipath' will not be installed, because command 'multipath' could not be found!
*** Including module: bash ***
*** Including module: nss-softokn ***
*** Including module: i18n ***
*** Including module: drm ***
*** Including module: plymouth ***
*** Including module: dm ***
Skipping udev rule: 64-device-mapper.rules
Skipping udev rule: 60-persistent-storage-dm.rules
Skipping udev rule: 55-dm.rules
*** Including module: kernel-modules ***
Omitting driver floppy
*** Including module: lvm ***
Skipping udev rule: 64-device-mapper.rules
Skipping udev rule: 56-lvm.rules
Skipping udev rule: 60-persistent-storage-lvm.rules
*** Including module: qemu ***
*** Including module: resume ***
*** Including module: rootfs-block ***
*** Including module: terminfo ***
*** Including module: udev-rules ***
Skipping udev rule: 40-redhat-cpu-hotplug.rules
Skipping udev rule: 91-permissions.rules
*** Including module: biosdevname ***
*** Including module: systemd ***
*** Including module: usrmount ***
*** Including module: base ***
*** Including module: fs-lib ***
*** Including module: shutdown ***
*** Including modules done ***
*** Installing kernel module dependencies and firmware ***
*** Installing kernel module dependencies and firmware done ***
*** Resolving executable dependencies ***
*** Resolving executable dependencies done***
*** Hardlinking files ***
*** Hardlinking files done ***
*** Stripping files ***
*** Stripping files done ***
*** Generating early-microcode cpio image contents ***
*** Constructing AuthenticAMD.bin ****
*** No early-microcode cpio image needed ***
*** Store current command line parameters ***
*** Creating image file ***
*** Creating image file done ***
*** Creating initramfs image file '/boot/initramfs-3.10.0-862.2.3.el7.x86_64.img' done ***
[root@lvm boot]# # ---в файле /boot/grub2/grub.cfg меняем rd.lvm.lv=VolGroup00/LogVol00 на rd.lvm.lv=vg_root/lv_root
[root@lvm boot]# export TERM=xterm
[root@lvm boot]# vim /boot/grub2/grub.cfg
[?1049h[?1h=[2;1H▽[6n[2;1H  [1;1H]11;?[1;50r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[50;1H"/boot/grub2/grub.cfg" 127L, 3658C[>c[1;1H[34m#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub2-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#

### BEGIN /etc/grub.d/00_header ###[m
set pager=[31m1[m

if [32m[ -s $prefix/grubenv ][m[34m; then[m
  load_env
fi
if [32m[ "${next_entry}" ][m [34m; then[m
   set default=[31m"${next_entry}"[m
   set next_entry=
   save_env next_entry
   set boot_once=[33mtrue[m
else
   set default=[31m"${saved_entry}"[m
fi

if [32m[ x"${feature_menuentry_id}" = xy ][m[34m; then[m
  menuentry_id_option=[31m"--id"[m
else
  menuentry_id_option=[31m""[m
fi

export menuentry_id_option

if [32m[ "${prev_saved_entry}" ][m[34m; then[m
  set saved_entry=[31m"${prev_saved_entry}"[m
  save_env saved_entry
  set prev_saved_entry=
  save_env prev_saved_entry
  set boot_once=[33mtrue[m
fi

function savedefault {
  if [32m[ -z "${boot_once}" ][m[34m; then[m
    saved_entry=[31m"${chosen}"[m
    save_env saved_entry
  fi
}

function load_video {
  if [32m[ x$feature_all_video_module = xy ][m[34m; then[m
    insmod all_video
  else[50;173H1,1[11CTop[1;1H[?12l[?25h[?25l[50;1H[K[50;1H/[?12l[?25hr[?25l[?12l[?25hf[?25l[?12l[?25h\[?25l[?12l[?25h[?25l[50;4H[K[50;4H[?12l[?25h[?25l[50;3H[K[50;3H[?12l[?25hd[?25l[?12l[?25h\[?25l[?12l[?25h.[?25l[?12l[?25hl[?25l[?12l[?25hv[?25l[?12l[?25hm[?25l[?12l[?25h[?25l[27m[m[H[2J[1;3Hsource $[32m{prefix}[m/user.cfg
  if [32m[ -n "${GRUB2_PASSWORD}" ][m[34m; then[m
    set superusers=[31m"root"[m
    export superusers
    password_pbkdf2 root $[32m{GRUB2_PASSWORD}[m
  fi
fi
[34m### END /etc/grub.d/01_users ###

### BEGIN /etc/grub.d/10_linux ###[m
menuentry 'CentOS Linux (3.10.0-862.2.3.el7.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-862.2.3.el7.x86_64--[12;1Hadvanced-e0b0c4c9-df0b-45e9-a666-b45c7d5f5ff1' {[13;9Hload_video[14;9Hset gfxpayload=[31mkeep[m[15;9Hinsmod gzio[16;9Hinsmod part_msdos[17;9Hinsmod xfs[18;9Hset root=[31m'hd0,msdos2'[m[19;9Hif [32m[ x$feature_platform_search_hint = xy ][m[34m; then[m[20;11Hsearch --no-floppy --fs-uuid --set=[31mroot --hint-bios=hd0,msdos2 --hint-efi=hd0,msdos2 --hint-baremetal=ahci0,msdos2  570897ca-e759-4c81-90cf-389da6eee4cc[m[21;9Helse[22;11Hsearch --no-floppy --fs-uuid --set=[31mroot 570897ca-e759-4c81-90cf-389da6eee4cc[m[23;9Hfi[24;9Hlinux16 /vmlinuz-3.10.0-862.2.3.el7.x86_64 root=[31m/dev/mapper/vg_root-lv_root ro no_timer_check console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 elevator=noop crashkernee[25;1Hl=auto [m[30m[43mrd.lvm[m[31m.lv=VolGroup00/LogVol00 [m[30m[43mrd.lvm[m[31m.lv=VolGroup00/LogVol01 rhgb quiet [m[26;9Hinitrd16 /initramfs-3.10.0-862.2.3.el7.x86_64.img
}
if [32m[ "x$default" = 'CentOS Linux (3.10.0-862.2.3.el7.x86_64) 7 (Core)' ][m[34m; then default='Advanced options for CentOS Linux>CentOS Linux (3.10.0-862.2.3.el7.x86_64) 7 (Core)'; fi;
### END /etc/grub.d/10_linux ###

### BEGIN /etc/grub.d/20_linux_xen ###
### END /etc/grub.d/20_linux_xen ###

### BEGIN /etc/grub.d/20_ppc_terminfo ###
### END /etc/grub.d/20_ppc_terminfo ###

### BEGIN /etc/grub.d/30_os-prober ###
### END /etc/grub.d/30_os-prober ###

### BEGIN /etc/grub.d/40_custom ###
# This file provides an easy way to add custom menu entries.  Simply type the
# menu entries you want to add after this comment.  Be careful not to change
# the 'exec tail' line above.
### END /etc/grub.d/40_custom ###

### BEGIN /etc/grub.d/41_custom ###[m
if [32m[ -f  ${config_directory}/custom.cfg ][m[34m; then[m
  source $[32m{config_directory}[m/custom.cfg
elif [32m[ -z "${config_directory}" -a -f  $prefix/custom.cfg ][m[34m; then[m[50;173H100,191-198   96%[25;8H[?12l[?25h[?25l[50;175H1,2-9    [26;9H[?12l[?25h[?25l[50;177H11-18[26;18H[?12l[?25h[?25l[50;177H2-9  [26;9H[?12l[?25h[?25l[50;175H0,256-263[25;73H[?12l[?25h[?25l[50;1H/rd\.lvm[50;173H[K[50;1H[31msearch hit BOTTOM, continuing at TOP[m[136C100,191-198   96%[50;173H[K[50;173H100,191-198   96%[25;8H[?12l[?25h[?25l[50;1H/rd\.lvm[50;9H[K[50;1H[172C100,221-228   96%[25;38H[?12l[?25h[?25l[50;173H[K[50;1H[31msearch hit BOTTOM, continuing at TOP[m[136C100,191-198   96%[50;173H[K[50;173H100,191-198   96%[25;8H[?12l[?25h[?25l[50;179H3-200[25;10H[?12l[?25h[?25l[50;179H4-201[25;11H[?12l[?25h[?25l[50;179H7-204[25;14H[?12l[?25h[?25l[50;179H8-205[25;15H[?12l[?25h[?25l[50;177H200-207[25;17H[?12l[?25h[?25l[50;179H1-208[25;18H[?12l[?25h[?25l[50;1H[1m-- VISUAL --[m[50;13H[K[50;173H100,201-208   96%[25;18H[?12l[?25h[?25l[7m[31mVolGroup0[m[50;178H10-217[25;27H[?12l[?25h[?25l[7m[31m0[m[50;179H1-218[25;28H[?12l[?25h[?25l[7m[31m/LogVol0[m[50;179H9-226[25;36H[?12l[?25h[?25l[50;4H[1mINSERT [m[50;173H[K[50;173H100,201-208   96%[25;18H[31m [m[30m[43mrd.lvm[m[31m.lv=VolGroup00/LogVol01 rhgb quiet [m[25;60H[K[25;18H[?12l[?25h[?25l[31mvg_root/lv_root [m[30m[43mrd.lvm[m[31m.lv=VolGroup00/LogVol01 rhgb quiet [m[50;178H16-223[25;33H[?12l[?25h[50;1H[K[?25l[50;173H100,215-222   96%[25;32H[?12l[?25h[?25l[50;179H7-224[25;34H[?12l[?25h[?25l[50;179H9-226[25;36H[?12l[?25h[?25l[50;178H20-227[25;37H[?12l[?25h[?25l[50;179H3-230[25;40H[?12l[?25h[?25l[50;179H4-231[25;41H[?12l[?25h[?25l[50;179H6-233[25;43H[?12l[?25h[?25l[50;179H7-234[25;44H[?12l[?25h[?25l[50;1H[1m-- VISUAL --[m[50;173H[K[50;173H100,227-234   96%[25;44H[?12l[?25h[?25l[7m[31mVolGroup0[m[50;178H36-243[25;53H[?12l[?25h[?25l[7m[31m0[m[50;179H7-244[25;54H[?12l[?25h[?25l[7m[31m/LogVol0[m[50;178H45-252[25;62H[?12l[?25h[?25l[50;4H[1mINSERT [m[50;173H[K[50;173H100,227-234   96%[25;44H[31m rhgb quiet [m[25;56H[K[25;44H[?12l[?25h[?25l[31mvg_root/lv_root rhgb quiet [m[50;178H42-249[25;59H[?12l[?25h[50;1H[K[?25l[50;173H100,241-248   96%[25;58H[?12l[?25h[?25l[50;173H[K[50;1H:[?12l[?25hW[?25l[?12l[?25h[?25l[1m[37m[41mE492: Not an editor command: W[m[142C100,241-248   96%[25;58H[?12l[?25h[?25l[50;1H[K[50;1H:[?12l[?25hw[?25l[?12l[?25h[?25l"grub2/grub.cfg" 127L, 3650C written[136C100,241-248   96%[50;173H[K[50;173H100,241-248   96%[25;58H[?12l[?25h[?25l[50;1H[K[50;1H:[?12l[?25hq[?25l[?12l[?25h[?25l[50;1H[K[50;1H[?1l>[?12l[?25h[?1049l[root@lvm boot]# exit
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# reboot
Connection to 127.0.0.1 closed by remote host.
[?2004h[01;32mzoid@npc[00m:[01;34m~/projects/otus/2023-04-linux/03-2[00m$ vagrant ssh
[?2004lLast login: Sun May 21 08:17:42 2023 from 10.0.2.2
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ va  sudo -i
[root@lvm ~]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:1    0 37.5G  0 lvm  
  └─VolGroup00-LogVol01 253:2    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
└─vg_root-lv_root       253:0    0   10G  0 lvm  /
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 
[root@lvm ~]# # --- уменьшаем размер старого логического тома с 40ГБ до 8ГБ (через удаление)
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# lvremove /dev/VolGroup00/LogVol00
Do you really want to remove active logical volume VolGroup00/LogVol00? [y/n]: y
  Logical volume "LogVol00" successfully removed
[root@lvm ~]# lvcreate -n VolGroup00/LogVol00 -L 8G /dev/VolGroup00
WARNING: xfs signature detected on /dev/VolGroup00/LogVol00 at offset 0. Wipe it? [y/n]: y
  Wiping xfs signature on /dev/VolGroup00/LogVol00.
  Logical volume "LogVol00" created.
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# # --- повторяем действия по переносу корневой системы (только без исправления grub)
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# mkfs.xfs /dev/VolGroup00/LogVol00
meta-data=/dev/VolGroup00/LogVol00 isize=512    agcount=4, agsize=524288 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=2097152, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[root@lvm ~]# mount /dev/VolGroup00/LogVol00 /mnt
[root@lvm ~]# xfsdump -J - /dev/vg_root/lv_root | xfsrestore -J - /mnt
xfsdump: using file dump (drive_simple) strategy
xfsdump: version 3.1.7 (dump format 3.0)
xfsdump: level 0 dump of lvm:/
xfsdump: dump date: Sun May 21 08:22:42 2023
xfsdump: session id: 1267e970-342b-46ef-b8a7-ec4a062e4d71
xfsdump: session label: ""
xfsrestore: using file dump (drive_simple) strategy
xfsrestore: version 3.1.7 (dump format 3.0)
xfsrestore: searching media for dump
xfsdump: ino map phase 1: constructing initial dump list
xfsdump: ino map phase 2: skipping (no pruning necessary)
xfsdump: ino map phase 3: skipping (only one dump stream)
xfsdump: ino map construction complete
xfsdump: estimated dump size: 934747776 bytes
xfsdump: creating dump session media file 0 (media 0, file 0)
xfsdump: dumping ino map
xfsdump: dumping directories
xfsrestore: examining media file 0
xfsrestore: dump description: 
xfsrestore: hostname: lvm
xfsrestore: mount point: /
xfsrestore: volume: /dev/mapper/vg_root-lv_root
xfsrestore: session time: Sun May 21 08:22:42 2023
xfsrestore: level: 0
xfsrestore: session label: ""
xfsrestore: media label: ""
xfsrestore: file system id: e0b0c4c9-df0b-45e9-a666-b45c7d5f5ff1
xfsrestore: session id: 1267e970-342b-46ef-b8a7-ec4a062e4d71
xfsrestore: media id: b3c99d9b-9068-43d3-8b64-60f0a4ba0518
xfsrestore: searching media for directory dump
xfsrestore: reading directories
xfsdump: dumping non-directory files
xfsrestore: 3163 directories and 28285 entries processed
xfsrestore: directory post-processing
xfsrestore: restoring non-directory files
xfsdump: ending media file
xfsdump: media file size 904537704 bytes
xfsdump: dump size (non-dir files) : 888502560 bytes
xfsdump: dump complete: 13 seconds elapsed
xfsdump: Dump Status: SUCCESS
xfsrestore: restore complete: 13 seconds elapsed
xfsrestore: Restore Status: SUCCESS
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# for i in /proc/ /sys/ /dev/ /run/ /boot/; do mount --bind $i /mnt/$i; done
[root@lvm ~]# chroot /mnt/
[root@lvm /]# grub2-mkconfig -o /boot/grub2/grub.cfg
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-3.10.0-862.2.3.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-862.2.3.el7.x86_64.img
done
[root@lvm /]# cd /boot ; for i in `ls initramfs-*img`; do dracut -v $i `echo $i|sed "s/initramfs-//g;  s/.img//g"` --force; done
Executing: /sbin/dracut -v initramfs-3.10.0-862.2.3.el7.x86_64.img 3.10.0-862.2.3.el7.x86_64 --force
dracut module 'busybox' will not be installed, because command 'busybox' could not be found!
dracut module 'crypt' will not be installed, because command 'cryptsetup' could not be found!
dracut module 'dmraid' will not be installed, because command 'dmraid' could not be found!
dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!
dracut module 'multipath' will not be installed, because command 'multipath' could not be found!
dracut module 'busybox' will not be installed, because command 'busybox' could not be found!
dracut module 'crypt' will not be installed, because command 'cryptsetup' could not be found!
dracut module 'dmraid' will not be installed, because command 'dmraid' could not be found!
dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!
dracut module 'multipath' will not be installed, because command 'multipath' could not be found!
*** Including module: bash ***
*** Including module: nss-softokn ***
*** Including module: i18n ***
*** Including module: drm ***
*** Including module: plymouth ***
*** Including module: dm ***
Skipping udev rule: 64-device-mapper.rules
Skipping udev rule: 60-persistent-storage-dm.rules
Skipping udev rule: 55-dm.rules
*** Including module: kernel-modules ***
Omitting driver floppy
*** Including module: lvm ***
Skipping udev rule: 64-device-mapper.rules
Skipping udev rule: 56-lvm.rules
Skipping udev rule: 60-persistent-storage-lvm.rules
*** Including module: qemu ***
*** Including module: resume ***
*** Including module: rootfs-block ***
*** Including module: terminfo ***
*** Including module: udev-rules ***
Skipping udev rule: 40-redhat-cpu-hotplug.rules
Skipping udev rule: 91-permissions.rules
*** Including module: biosdevname ***
*** Including module: systemd ***
*** Including module: usrmount ***
*** Including module: base ***
*** Including module: fs-lib ***
*** Including module: shutdown ***
*** Including modules done ***
*** Installing kernel module dependencies and firmware ***
*** Installing kernel module dependencies and firmware done ***
*** Resolving executable dependencies ***
*** Resolving executable dependencies done***
*** Hardlinking files ***
*** Hardlinking files done ***
*** Stripping files ***
*** Stripping files done ***
*** Generating early-microcode cpio image contents ***
*** Constructing AuthenticAMD.bin ****
*** No early-microcode cpio image needed ***
*** Store current command line parameters ***
*** Creating image file ***
*** Creating image file done ***
*** Creating initramfs image file '/boot/initramfs-3.10.0-862.2.3.el7.x86_64.img' done ***
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]#  --- пока не выходим из chroot и не перезагруемся, переносим var[root@lvm boot]# # --- пока не выходим из chroot и не перезагруемся, переносим var[root@lvm boot]# #
[root@lvm boot]# #    --- пока не выходим из chroot и не перезагруемся, переносим var                                                                 Выделяем том под /var (/var - сделать в mirror)
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# pvcreate /dev/sdc /dev/sdd
  Physical volume "/dev/sdc" successfully created.
  Physical volume "/dev/sdd" successfully created.
[root@lvm boot]# vgcreate vg_var /dev/sdc /dev/sdd
  Volume group "vg_var" successfully created
[root@lvm boot]# lvcreate -L 950M -m1 -n lv_var vg_var
  Rounding up size to full physical extent 952.00 MiB
  Logical volume "lv_var" created.
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# # --- Создаем на нем ФС и перемещаем туда /var:
[root@lvm boot]# mkfs.ext4 /dev/vg_var/lv_var
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
60928 inodes, 243712 blocks
12185 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=249561088
8 block groups
32768 blocks per group, 32768 fragments per group
7616 inodes per group
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376

Allocating group tables: 0/8   done                            
Writing inode tables: 0/8   done                            
Creating journal (4096 blocks): done
Writing superblocks and filesystem accounting information: 0/8   done

[root@lvm boot]# mount /dev/vg_var/lv_var /mnt
[root@lvm boot]# cp -aR /var/* /mnt/
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# # --- сохраняем содержимое старого var
[root@lvm boot]# mkdir /tmp/oldvar && mv /var/* /tmp/oldvar
[root@lvm boot]# # --- монтируем новый var в /var
[root@lvm boot]# umount /mnt
[root@lvm boot]# mount /dev/vg_var/lv_var /var
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# # --- правим fstab для автомонтирования /var
[root@lvm boot]# echo "`blkid | grep var: | awk '{print $2}'` /var ext4 defaults 0 0" >> /etc/fstab
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# # --- удаляем временные тома
[root@lvm boot]# lvremove /dev/vg_root/lv_root
  Logical volume vg_root/lv_root contains a filesystem in use.
[root@lvm boot]# vgremove /dev/vg_root
Do you really want to remove volume group "vg_root" containing 1 logical volumes? [y/n]: y
  Logical volume vg_root/lv_root contains a filesystem in use.
[root@lvm boot]# pvremove /dev/sdb
  Can't open /dev/sdb exclusively.  Mounted filesystem?
[root@lvm boot]# ll /mnt
total 0
[root@lvm boot]# mount /dev/sdv b|/dev/sdb /dev/sdbg/dev/sdbr/dev/sdbe/dev/sdbp/dev/sdb /dev/sdb
[root@lvm boot]# mount | grep /dev/sdb[root@lvm boot]# ll /mnt              mount | grep /dev/sdb[root@lvm boot]#                      [root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# l pvs
  PV         VG         Fmt  Attr PSize    PFree  
  /dev/sda3  VolGroup00 lvm2 a--   <38.97g <29.47g
  /dev/sdb   vg_root    lvm2 a--   <10.00g      0 
  /dev/sdc   vg_var     lvm2 a--    <2.00g   1.06g
  /dev/sdd   vg_var     lvm2 a--  1020.00m  64.00m
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# df  lk sblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:1    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:2    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:0    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:3    0    4M  0 lvm  
│ └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0 253:4    0  952M  0 lvm  
  └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:5    0    4M  0 lvm  
│ └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1 253:6    0  952M  0 lvm  
  └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
sde                        8:64   0    1G  0 disk 
[root@lvm boot]# vgremove /dev/vg_root
Do you really want to remove volume group "vg_root" containing 1 logical volumes? [y/n]: y
  Logical volume vg_root/lv_root contains a filesystem in use.
[root@lvm boot]# lvremove /dev/vg_root/lv_root
  Logical volume vg_root/lv_root contains a filesystem in use.
[root@lvm boot]# 
[root@lvm boot]# 
[root@lvm boot]# lvs
  LV       VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  LogVol00 VolGroup00 -wi-ao----   8.00g                                                    
  LogVol01 VolGroup00 -wi-ao----   1.50g                                                    
  lv_root  vg_root    -wi-ao---- <10.00g                                                    
  lv_var   vg_var     rwi-aor--- 952.00m                                    100.00          
[root@lvm boot]# exit
[root@lvm ~]# chroot /mnt/for i in /proc/ /sys/ /dev/ /run/ /boot/; do mount --bind $i /mnt/$i; done[root@lvm ~]# chroot /mnt/                                                              [root@lvm ~]# chroot /mnt/for i in /proc/ /sys/ /dev/ /run/ /boot/; do mount --bind $i /mnt/$i; done[root@lvm ~]# xfsdump -J - /dev/vg_root/lv_root | xfsrestore -J - /mnt                  [root@lvm ~]# for i in /proc/ /sys/ /dev/ /run/ /boot/; do mount --bind $i /mnt/$i; done[root@lvm ~]# chroot /mnt/                                                              [root@lvm ~]# chroot /mnt/            
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# lvremove /dev/vg_root/lv_root
  Logical volume vg_root/lv_root contains a filesystem in use.
[root@lvm ~]# mount | grep lv_root
/dev/mapper/vg_root-[01;31m[Klv_root[m[K on / type xfs (rw,relatime,seclabel,attr2,inode64,noquota)
[root@lvm ~]# umount /mnt
umount: /mnt: target is busy.
        (In some cases useful info about processes that use
         the device is found by lsof(8) or fuser(1))
[root@lvm ~]# logout
[vagrant@lvm ~]$ sudo reboot
PolicyKit daemon disconnected from the bus.
We are no longer a registered authentication agent.
Connection to 127.0.0.1 closed by remote host.
[?2004h[01;32mzoid@npc[00m:[01;34m~/projects/otus/2023-04-linux/03-2[00m$ vagrant ssh[1Pupssh
[?2004lLast login: Sun May 21 08:21:45 2023 from 10.0.2.2
[vagrant@lvm ~]$ ыгвщ    sudo -i
[root@lvm ~]# lvs
  LV       VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  LogVol00 VolGroup00 -wi-ao----   8.00g                                                    
  LogVol01 VolGroup00 -wi-ao----   1.50g                                                    
  lv_root  vg_root    -wi-a----- <10.00g                                                    
  lv_var   vg_var     rwi-aor--- 952.00m                                    100.00          
[root@lvm ~]# f df
Filesystem                      1K-blocks   Used Available Use% Mounted on
/dev/mapper/VolGroup00-LogVol00   8378368 951688   7426680  12% /
devtmpfs                           111876      0    111876   0% /dev
tmpfs                              120692      0    120692   0% /dev/shm
tmpfs                              120692   4508    116184   4% /run
tmpfs                              120692      0    120692   0% /sys/fs/cgroup
/dev/sda2                         1038336  62216    976120   6% /boot
/dev/mapper/vg_var-lv_var          943128 238752    639252  28% /var
[root@lvm ~]# pvremove /dev/sdb
  Can't open /dev/sdb exclusively.  Mounted filesystem?
[root@lvm ~]# lvremove /dev/vg_root/lv_root
Do you really want to remove active logical volume vg_root/lv_root? [y/n]: y
  Logical volume "lv_root" successfully removed
[root@lvm ~]# vgremove /dev/vg_root
  Volume group "vg_root" successfully removed
[root@lvm ~]# pvremove /dev/sdb
  Labels on physical volume "/dev/sdb" successfully wiped.
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# pvs
  PV         VG         Fmt  Attr PSize    PFree  
  /dev/sda3  VolGroup00 lvm2 a--   <38.97g <29.47g
  /dev/sdc   vg_var     lvm2 a--    <2.00g   1.06g
  /dev/sdd   vg_var     lvm2 a--  1020.00m  64.00m
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:3    0    4M  0 lvm  
│ └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0 253:4    0  952M  0 lvm  
  └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:5    0    4M  0 lvm  
│ └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1 253:6    0  952M  0 lvm  
  └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
sde                        8:64   0    1G  0 disk 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# # Выделяем том под /home
[root@lvm ~]# # Делаем по принципу с /var
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# lvcreate -n LogVol_Home -L 2G /dev/VolGroup00
  Logical volume "LogVol_Home" created.
[root@lvm ~]# mkfs.xfs /dev/VolGroup00/LogVol_Home
meta-data=/dev/VolGroup00/LogVol_Home isize=512    agcount=4, agsize=131072 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=524288, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# mount /dev/VolGroup00/LogVol_Home /mnt/
[root@lvm ~]# cp -aR /home/* /mnt/
[root@lvm ~]# rm -rf /home/*
[root@lvm ~]# umount /mnt
[root@lvm ~]# mount /dev/VolGroup00/LogVol_Home /home/
[root@lvm ~]# echo "`blkid | grep Home | awk '{print $2}'` /home xfs defaults 0 0" >> /etc/fstab
[root@lvm ~]# reboot
Error getting authority: Error initializing authority: Error calling StartServiceByName for org.freedesktop.PolicyKit1: Timeout was reached (g-io-error-quark, 24)
Failed to start reboot.target: Connection timed out
See system logs and 'systemctl status reboot.target' for details.
[root@lvm ~]# logout
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ sudo reboot
Error getting authority: Error initializing authority: Error calling StartServiceByName for org.freedesktop.PolicyKit1: Timeout was reached (g-io-error-quark, 24)
Failed to start reboot.target: Connection timed out
See system logs and 'systemctl status reboot.target' for details.
[vagrant@lvm ~]$ ls  sudo -i
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# lsblk
NAME                       MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                          8:0    0   40G  0 disk 
├─sda1                       8:1    0    1M  0 part 
├─sda2                       8:2    0    1G  0 part /boot
└─sda3                       8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00    253:0    0    8G  0 lvm  /
  ├─VolGroup00-LogVol01    253:1    0  1.5G  0 lvm  [SWAP]
  └─VolGroup00-LogVol_Home 253:2    0    2G  0 lvm  /home
sdb                          8:16   0   10G  0 disk 
sdc                          8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0    253:3    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0   253:4    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sdd                          8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1    253:5    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1   253:6    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sde                          8:64   0    1G  0 disk 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# logout
[vagrant@lvm ~]$ logout
[?2004h[01;32mzoid@npc[00m:[01;34m~/projects/otus/2023-04-linux/03-2[00m$ vagrant help-help-help
[?2004l[0mUsage: vagrant [options] <command> [<args>]

    -h, --help                       Print this help.

Common commands:
     autocomplete    manages autocomplete installation on host
     box             manages boxes: installation, removal, etc.
     cloud           manages everything related to Vagrant Cloud
     destroy         stops and deletes all traces of the vagrant machine
     global-status   outputs status Vagrant environments for this user
     halt            stops the vagrant machine
     help            shows the help for a subcommand
     init            initializes a new Vagrant environment by creating a Vagrantfile
     login           
     package         packages a running vagrant environment into a box
     plugin          manages plugins: install, uninstall, update, etc.
     port            displays information about guest port mappings
     powershell      connects to machine via powershell remoting
     provision       provisions the vagrant machine
     push            deploys code in this environment to a configured destination
     rdp             connects to machine via RDP
     reload          restarts vagrant machine, loads new Vagrantfile configuration
     resume          resume a suspended vagrant machine
     serve           start Vagrant server
     snapshot        manages snapshots: saving, restoring, etc.
     ssh             connects to machine via SSH
     ssh-config      outputs OpenSSH valid configuration to connect to the machine
     status          outputs status of the vagrant machine
     suspend         suspends the machine
     up              starts and provisions the vagrant environment
     upload          upload to machine via communicator
     validate        validates the Vagrantfile
     version         prints current and latest Vagrant version
     winrm           executes commands on a machine via WinRM
     winrm-config    outputs WinRM configuration to connect to the machine

For help on any individual command run `vagrant COMMAND -h`

Additional subcommands are available, but are either more advanced
or not commonly used. To see all subcommands, run the command
`vagrant list-commands`.
        --[no-]color                 Enable or disable color output
        --machine-readable           Enable machine readable output
    -v, --version                    Display Vagrant version
        --debug                      Enable debug output
        --timestamp                  Enable timestamps on log output
        --debug-timestamp            Enable debug output with timestamps
        --no-tty                     Enable non-interactive output
[0m
[?2004h[01;32mzoid@npc[00m:[01;34m~/projects/otus/2023-04-linux/03-2[00m$ vagrant reload
[?2004l[1m==> lvm: Attempting graceful shutdown of VM...[0m
[1m==> lvm: Checking if box 'centos/7' version '1804.02' is up to date...[0m
[1m==> lvm: Clearing any previously set forwarded ports...[0m
[1m==> lvm: Clearing any previously set network interfaces...[0m
[1m==> lvm: Preparing network interfaces based on configuration...[0m
[0m    lvm: Adapter 1: nat[0m
[1m==> lvm: Forwarding ports...[0m
[0m    lvm: 22 (guest) => 2222 (host) (adapter 1)[0m
[1m==> lvm: Running 'pre-boot' VM customizations...[0m
[1m==> lvm: Booting VM...[0m
[1m==> lvm: Waiting for machine to boot. This may take a few minutes...[0m
[0m    lvm: SSH address: 127.0.0.1:2222[0m
[0m    lvm: SSH username: vagrant[0m
[0m    lvm: SSH auth method: private key[0m
[1m==> lvm: Machine booted and ready![0m
[1m==> lvm: Checking for guest additions in VM...[0m
[0m    lvm: No guest additions were detected on the base box for this VM! Guest
    lvm: additions are required for forwarded ports, shared folders, host only
    lvm: networking, and more. If SSH fails on this machine, please install
    lvm: the guest additions and repackage the box to continue.
    lvm: 
    lvm: This is not an error message; everything may continue to work properly,
    lvm: in which case you may ignore this message.[0m
[1m==> lvm: Setting hostname...[0m
[1m==> lvm: Rsyncing folder: /home/zoid/projects/otus/2023-04-linux/03-2/ => /vagrant[0m
[1m==> lvm: Machine already provisioned. Run `vagrant provision` or use the `--provision`
==> lvm: flag to force provisioning. Provisioners marked to run always will still run.[0m
[?2004h[01;32mzoid@npc[00m:[01;34m~/projects/otus/2023-04-linux/03-2[00m$ vagrant ssh
[?2004lLast login: Sun May 21 08:31:33 2023 from 10.0.2.2
[vagrant@lvm ~]$ sudo -o i
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# lsblk
NAME                       MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                          8:0    0   40G  0 disk 
├─sda1                       8:1    0    1M  0 part 
├─sda2                       8:2    0    1G  0 part /boot
└─sda3                       8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00    253:0    0    8G  0 lvm  /
  ├─VolGroup00-LogVol01    253:1    0  1.5G  0 lvm  [SWAP]
  └─VolGroup00-LogVol_Home 253:2    0    2G  0 lvm  /home
sdb                          8:16   0   10G  0 disk 
sdc                          8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0    253:3    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0   253:4    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sdd                          8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1    253:5    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1   253:6    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sde                          8:64   0    1G  0 disk 
[root@lvm ~]# logout
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ # для /home - сделать том для снэпшотов
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ # --- !!! обязательно выходим из домашней директории !!!
[vagrant@lvm ~]$ cd /tmp
[vagrant@lvm tmp]$ sudo -i
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# # --- создаем произвольный файлы в домашней          h /home
[root@lvm ~]# touch /home/file{1..20}
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# ls -l /home
total 0
-rw-r--r--. 1 root    root     0 May 21 08:39 file1
-rw-r--r--. 1 root    root     0 May 21 08:39 file10
-rw-r--r--. 1 root    root     0 May 21 08:39 file11
-rw-r--r--. 1 root    root     0 May 21 08:39 file12
-rw-r--r--. 1 root    root     0 May 21 08:39 file13
-rw-r--r--. 1 root    root     0 May 21 08:39 file14
-rw-r--r--. 1 root    root     0 May 21 08:39 file15
-rw-r--r--. 1 root    root     0 May 21 08:39 file16
-rw-r--r--. 1 root    root     0 May 21 08:39 file17
-rw-r--r--. 1 root    root     0 May 21 08:39 file18
-rw-r--r--. 1 root    root     0 May 21 08:39 file19
-rw-r--r--. 1 root    root     0 May 21 08:39 file2
-rw-r--r--. 1 root    root     0 May 21 08:39 file20
-rw-r--r--. 1 root    root     0 May 21 08:39 file3
-rw-r--r--. 1 root    root     0 May 21 08:39 file4
-rw-r--r--. 1 root    root     0 May 21 08:39 file5
-rw-r--r--. 1 root    root     0 May 21 08:39 file6
-rw-r--r--. 1 root    root     0 May 21 08:39 file7
-rw-r--r--. 1 root    root     0 May 21 08:39 file8
-rw-r--r--. 1 root    root     0 May 21 08:39 file9
drwx------. 3 vagrant vagrant 95 May 21 08:35 vagrant
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# # --- создаем snapshot
[root@lvm ~]# lvcreate -L 100MB -s -n home_snap /dev/VolGroup00/LogVol_Home
  Rounding up size to full physical extent 128.00 MiB
  Logical volume "home_snap" created.
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# # --- удаляем часть файлов
[root@lvm ~]# rm -f /home/file{11..20}
[root@lvm ~]# ls-  -l /home
total 0
-rw-r--r--. 1 root    root     0 May 21 08:39 file1
-rw-r--r--. 1 root    root     0 May 21 08:39 file10
-rw-r--r--. 1 root    root     0 May 21 08:39 file2
-rw-r--r--. 1 root    root     0 May 21 08:39 file3
-rw-r--r--. 1 root    root     0 May 21 08:39 file4
-rw-r--r--. 1 root    root     0 May 21 08:39 file5
-rw-r--r--. 1 root    root     0 May 21 08:39 file6
-rw-r--r--. 1 root    root     0 May 21 08:39 file7
-rw-r--r--. 1 root    root     0 May 21 08:39 file8
-rw-r--r--. 1 root    root     0 May 21 08:39 file9
drwx------. 3 vagrant vagrant 95 May 21 08:35 vagrant
[root@lvm ~]# # --- восстанавливаем файлы
[root@lvm ~]# umount /home
[root@lvm ~]# lvconvert --merge /dev/VolGroup00/home_snap
  Merging of volume VolGroup00/home_snap started.
  VolGroup00/LogVol_Home: Merged: 100.00%
[root@lvm ~]# mount /home
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# ls -l /home
total 0
-rw-r--r--. 1 root    root     0 May 21 08:39 file1
-rw-r--r--. 1 root    root     0 May 21 08:39 file10
-rw-r--r--. 1 root    root     0 May 21 08:39 file11
-rw-r--r--. 1 root    root     0 May 21 08:39 file12
-rw-r--r--. 1 root    root     0 May 21 08:39 file13
-rw-r--r--. 1 root    root     0 May 21 08:39 file14
-rw-r--r--. 1 root    root     0 May 21 08:39 file15
-rw-r--r--. 1 root    root     0 May 21 08:39 file16
-rw-r--r--. 1 root    root     0 May 21 08:39 file17
-rw-r--r--. 1 root    root     0 May 21 08:39 file18
-rw-r--r--. 1 root    root     0 May 21 08:39 file19
-rw-r--r--. 1 root    root     0 May 21 08:39 file2
-rw-r--r--. 1 root    root     0 May 21 08:39 file20
-rw-r--r--. 1 root    root     0 May 21 08:39 file3
-rw-r--r--. 1 root    root     0 May 21 08:39 file4
-rw-r--r--. 1 root    root     0 May 21 08:39 file5
-rw-r--r--. 1 root    root     0 May 21 08:39 file6
-rw-r--r--. 1 root    root     0 May 21 08:39 file7
-rw-r--r--. 1 root    root     0 May 21 08:39 file8
-rw-r--r--. 1 root    root     0 May 21 08:39 file9
drwx------. 3 vagrant vagrant 95 May 21 08:35 vagrant
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# # The End/ .
[root@lvm ~]# logout
[vagrant@lvm tmp]$ logout
[?2004h[01;32mzoid@npc[00m:[01;34m~/projects/otus/2023-04-linux/03-2[00m$ [?2004l
exit

Script done on 2023-05-21 11:41:03+03:00 [COMMAND_EXIT_CODE="0"]
