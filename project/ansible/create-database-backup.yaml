- name: Create backup
  hosts: barman
  become: true
  vars:
    db: db2
  tasks:
    - name: Create database backup
      ansible.builtin.shell: "barman backup {{ db }}"
      become_user: barman

    - name: List backups
      ansible.builtin.shell: "barman list-backups {{ db }}"
      register: backups
      become_user: barman

    - debug: msg="{{ backups.stdout }}"
