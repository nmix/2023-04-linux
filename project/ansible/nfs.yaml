- name: Config NFS for app files
  hosts: fs
  become: true
  vars:
    nfs_server_ip: 10.10.1.141
  tasks:
    - name: Install nfs packages
      ansible.builtin.dnf:
        name:
          - nfs-utils
        state: present

    - name: Start nfs service
      ansible.builtin.service:
        name: nfs-server
        state: started
        enabled: true

    - name: Create share data directory
      ansible.builtin.file:
        path: /opt/cms/data
        state: directory
        owner: nobody
        group: nobody
        recurse: yes
        mode: '0777'

    - name: copy exports
      ansible.builtin.template:
        src: exports.j2
        dest: /etc/exports

    - name: export filesystem
      ansible.builtin.shell: exportfs -r
